---
import type { CollectionEntry } from 'astro:content';
import { Image } from 'astro:assets';
import Base from './Base.astro';
import FormattedDate from '../components/FormattedDate.astro';

type Props = CollectionEntry<'blog'>['data'];

const { title, description, pubDate, updatedDate, heroImage, tags = [], project = [], entities = [], related = [], type = [], committed } = Astro.props;

// Determine path for terminal header
const currentPath = `journal/${pubDate.toISOString().split('T')[0]}.md`;
---

<Base title={title} description={description} heroImage={heroImage} path={currentPath} mode="reading">
	<article class="blog-post">
		<div class="hero-image">
			{heroImage && <Image width={1020} height={510} src={heroImage} alt="" />}
		</div>
		<div class="prose">
			<div class="title-section">
				<div class="date">
					<FormattedDate date={pubDate} />
					{
						updatedDate && (
							<div class="last-updated-on">
								Last updated on <FormattedDate date={updatedDate} />
							</div>
						)
					}
				</div>
				<h1>{title}</h1>

                {committed && (
                    <div class="committed-time">
                        committed: {committed}
                    </div>
                )}

                <div class="tags-container">
                    {tags.map(tag => <span class="tag">#{tag}</span>)}
                </div>
				<hr />
			</div>
			<slot />
		</div>
	</article>

    <div slot="meta" class="meta-sidebar">
        <div class="meta-section">
            <h3>METADATA</h3>
            <div class="meta-item">
                <span class="label">Date:</span>
                <span class="value"><FormattedDate date={pubDate} /></span>
            </div>
            {committed && (
                <div class="meta-item">
                    <span class="label">Time:</span>
                    <span class="value">{committed}</span>
                </div>
            )}
            <div class="meta-item">
                <span class="label">Type:</span>
                <div class="value-list">
                    {type.map(t => <span class="meta-tag">{t}</span>)}
                </div>
            </div>
            <div class="meta-item">
                <span class="label">Project:</span>
                <div class="value-list">
                    {project.map(p => <span class="meta-tag">{p}</span>)}
                </div>
            </div>
        </div>

        {entities.length > 0 && (
            <div class="meta-section">
                <h3>ENTITIES</h3>
                <div class="value-list">
                    {entities.map(e => <span class="entity-tag">{e}</span>)}
                </div>
            </div>
        )}

        {related.length > 0 && (
            <div class="meta-section">
                <h3>RELATED</h3>
                <ul class="related-list">
                    {related.map(r => <li>{r}</li>)}
                </ul>
            </div>
        )}
    </div>
</Base>

<style>
	.hero-image {
		width: 100%;
        margin-bottom: var(--space-lg);
	}
	.hero-image img {
		display: block;
		margin: 0 auto;
		border-radius: 4px;
		box-shadow: var(--shadow-card);
        border: 1px solid var(--funes-terminal);
	}
	.prose {
		color: var(--funes-text-main);
	}
	.title-section {
		margin-bottom: var(--space-xl);
		text-align: left;
	}
	.date {
		margin-bottom: var(--space-xs);
		color: var(--funes-text-dim);
        font-family: var(--font-mono);
        font-size: var(--text-sm);
	}
	.last-updated-on {
		font-style: italic;
	}

    .committed-time {
        font-family: var(--font-mono);
        color: var(--funes-text-dim);
        font-size: var(--text-sm);
        margin-bottom: var(--space-sm);
    }

    .tags-container {
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-sm);
        margin-top: var(--space-md);
    }

    .tag {
        color: var(--funes-memory);
        font-family: var(--font-mono);
        font-size: var(--text-sm);
    }

    /* Meta Sidebar Styles */
    .meta-sidebar {
        font-family: var(--font-mono);
        font-size: var(--text-xs);
        color: var(--funes-text-dim);
    }

    .meta-section {
        margin-bottom: var(--space-xl);
        border-top: 1px solid var(--funes-bg-hover);
        padding-top: var(--space-sm);
    }

    .meta-section h3 {
        font-family: var(--font-mono);
        font-size: var(--text-xs);
        color: var(--funes-text-dimmer);
        margin: 0 0 var(--space-md) 0;
        letter-spacing: 0.1em;
    }

    .meta-item {
        margin-bottom: var(--space-sm);
    }

    .label {
        color: var(--funes-text-dimmer);
        display: block;
        margin-bottom: 2px;
    }

    .value {
        color: var(--funes-text-main);
    }

    .value-list {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
    }

    .meta-tag, .entity-tag {
        background: var(--funes-bg-hover);
        padding: 2px 6px;
        border-radius: 2px;
        color: var(--funes-text-main);
    }

    .related-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .related-list li {
        margin-bottom: var(--space-xs);
        padding-left: 1em;
        position: relative;
    }

    .related-list li::before {
        content: "â†’";
        position: absolute;
        left: 0;
        color: var(--funes-terminal);
    }
</style>
