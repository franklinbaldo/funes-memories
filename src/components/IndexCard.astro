---
import FormattedDate from './FormattedDate.astro';

interface Props {
  title: string;
  date: Date;
  slug: string;
  description?: string;
  tags?: string[];
  id?: string;
}

const { title, date, slug, description, tags = [], id } = Astro.props;
const baseUrlRaw = import.meta.env.BASE_URL || '/';
const baseUrl = baseUrlRaw.endsWith('/') ? baseUrlRaw : `${baseUrlRaw}/`;

// Generate a pseudo catalog number if not provided
const catalogNumber = id ? `MEM.${id}` : `MEM.${date.getFullYear()}.${Math.floor(Math.random() * 1000).toString().padStart(3, '0')}`;
---

<a href={`${baseUrl}blog/${slug}/`} class="block mb-8 group no-underline">
  <article class="bg-surface border border-line p-6 shadow-sm transition-all duration-300 group-hover:-translate-y-0.5 group-hover:shadow-md group-hover:border-ink-dim/30 relative overflow-hidden">

    <!-- Header with Hole Punch -->
    <div class="flex justify-between items-center border-b border-line pb-2 mb-4">
      <span class="font-mono text-xs text-ink-dim tracking-widest uppercase group-hover:text-signal transition-colors">{catalogNumber}</span>
      <div class="w-3 h-3 rounded-full bg-void shadow-[inset_0_1px_3px_rgba(0,0,0,0.8)] border border-white/5"></div>
    </div>

    <!-- Content -->
    <div class="flex flex-col gap-3">
      <h3 class="font-serif text-xl md:text-2xl text-ink leading-tight group-hover:text-candle transition-colors">
        {title}
      </h3>

      <div class="font-mono text-xs text-ink-dim">
        <FormattedDate date={date} />
      </div>

      {description && (
        <p class="text-sm text-ink/70 leading-relaxed line-clamp-3 mb-2 font-serif">
          {description}
        </p>
      )}

      {tags.length > 0 && (
        <div class="flex flex-wrap gap-2 mt-2">
          {tags.map(tag => (
            <span class="font-mono text-[10px] text-link opacity-70 group-hover:opacity-100 transition-opacity">#{tag}</span>
          ))}
        </div>
      )}
    </div>

    <!-- Footer -->
    <div class="mt-6 pt-3 border-t border-dashed border-line text-right">
      <span class="font-mono text-xs text-signal font-bold group-hover:text-candle transition-colors">[ACCESS MEMORY â†’]</span>
    </div>
  </article>
</a>
